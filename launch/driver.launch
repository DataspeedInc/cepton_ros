<!-- Launches nodelet manager, SDK driver, and transforms publisher. -->
<launch>
  <arg name="capture_loop" default="true" doc="capture replay loop"/>
  <arg name="capture_path" default="" doc="capture replay file path"/>
  <arg name="control_flags" default="0" doc="sdk control flags"/>
  <arg name="frame_mode" default="CYCLE" doc="sdk frame mode"/>
  <arg name="parent_frame_id" default="world" doc="parent transform frame"/>
  <arg name="transforms_path" default="" doc="transforms json file path"/>

  <arg name="combine_sensors" value="$(eval transforms_path == '')"/>

  <node pkg="nodelet" type="nodelet" name="cepton_manager" args="manager" output="screen"/>

  <node pkg="nodelet" type="nodelet" name="cepton_driver" args="load cepton_ros/DriverNodelet cepton_manager" output="screen">
    <param name="capture_path" value="$(arg capture_path)"/>
    <param name="capture_loop" value="$(arg capture_loop"/>
    <param name="combine_sensors" value="$(arg combine_sensors)"/>
    <param name="control_flags" value="$(arg control_flags)"/>
    <param name="frame_mode" value="$(arg frame_mode)"/>
  </node>

  <include file="$(find cepton_ros)/launch/transforms.launch">
    <arg name="parent_frame_id" value="$(arg parent_frame_id)"/>
    <arg name="transforms_path" value="$(find cepton_ros)/launch/settings/cepton_transforms.json" if="$(arg combine_sensors)"/>
    <arg name="transforms_path" value="$(arg transforms_path)" unless="$(arg combine_sensors)"/>
  </include>
</launch>
